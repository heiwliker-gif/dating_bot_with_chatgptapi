<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EvilCorp AI | Dating App</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #FF4757; --bg: #f2f4fb; --text: #1f2330; }
    [data-theme="dark"] { --bg: #0f111a; --text: #ffffff; }
    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; }
    .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
    .profile-card { background: #fff; border-radius: 25px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); position: relative; height: 60vh; }
    [data-theme="dark"] .profile-card { background: #1b1f2c; }
    .photo { height: 100%; background: linear-gradient(135deg, #FF4757 0%, #764ba2 100%); display: grid; place-items: center; position: relative; }
    .photo-emoji { font-size: 100px; }
    .info { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: #fff; }
    .actions { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
    .btn-act { width: 65px; height: 65px; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; transition: 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    .btn-act:hover { transform: scale(1.1); }
    .btn-like { background: var(--primary); color: #fff; }
    .modal { position: fixed; inset: 0; background: var(--bg); display: none; flex-direction: column; z-index: 1000; }
    .modal.active { display: flex; }
    .chat-log { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.4; }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
    .msg.other { align-self: flex-start; background: #e4e6eb; color: #000; border-bottom-left-radius: 4px; }
    [data-theme="dark"] .msg.other { background: #3a3b3c; color: #fff; }
    .chat-input { padding: 15px; display: flex; gap: 10px; background: var(--bg); border-top: 1px solid rgba(0,0,0,0.1); }
    .chat-input input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; outline: none; }
    .nav { display: flex; justify-content: space-around; padding: 15px; background: #fff; border-top: 1px solid #eee; position: sticky; bottom: 0; }
    [data-theme="dark"] .nav { background: #1b1f2c; border-top-color: #333; }
    .typing { padding: 10px 20px; font-size: 12px; color: var(--primary); font-style: italic; display: none; }
  </style>
</head>
<body>

  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin:0;">EvilCorp <span style="color:var(--primary)">AI</span></h2>
      <button onclick="toggleTheme()" style="background:none; border:none; font-size:20px;">üåó</button>
    </div>

    <div id="browseSection">
      <div class="profile-card">
        <div class="photo">
          <div class="photo-emoji" id="mainEmoji">ü¶Å</div>
        </div>
        <div class="info">
          <h2 id="pName">–¢—É—Ä–∞—à –ê–ª–∏, 23</h2>
          <p id="pBio">–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö.</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn-act" onclick="nextProfile()">‚úï</button>
        <button class="btn-act btn-like" onclick="likeProfile()">‚ù§Ô∏è</button>
      </div>
    </div>

    <div id="chatsSection" style="display:none;">
      <h3 style="margin-top:0;">–í–∞—à–∏ –ø–∞—Ä—ã</h3>
      <div id="matchesList"></div>
    </div>

    <div class="nav">
      <button onclick="showPage('browse')">üîç</button>
      <button onclick="showPage('chats')">üí¨</button>
    </div>
  </div>

  <div class="modal" id="chatModal">
    <div style="padding: 15px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px;">
      <button onclick="closeChat()" style="background:none; border:none; font-size:24px;">‚Üê</button>
      <strong id="chatName">–ß–∞—Ç</strong>
    </div>
    <div class="chat-log" id="chatLog"></div>
    <div id="typing" class="typing">–ø–µ—á–∞—Ç–∞–µ—Ç...</div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å...">
      <button onclick="sendMessage()" style="background:var(--primary); color:white; border:none; padding:10px 20px; border-radius:20px; cursor:pointer;">‚û§</button>
    </div>
  </div>

  <script>
    const GEMINI_API_KEY = 'AIzaSyBDHtROba4Ruz5EHaVZoA9QJRGaAiKsU4Y';

    const profiles = [
      { id: 1, name: '–¢—É—Ä–∞—à –ê–ª–∏', age: 23, bio: '–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö.', emoji: 'ü¶Å' },
      { id: 2, name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', age: 24, bio: '–õ—é–±–ª—é IT –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã.', emoji: 'üòé' },
      { id: 3, name: '–ê–π–≥–µ—Ä–∏–º', age: 21, bio: '–õ—é–±–ª—é –∏—Å–∫—É—Å—Å—Ç–≤–æ ‚ú®', emoji: 'üå∏' },
      { id: 4, name: '–ñ–∞–Ω–∏—è', age: 20, bio: '–¢–∞–Ω—Ü—ã ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å!‚òÄÔ∏è', emoji: 'üíÉ' }
    ];

    let currentIdx = 0;
    let matches = JSON.parse(localStorage.getItem('my_matches') || '[]');
    let chatHistory = JSON.parse(localStorage.getItem('my_chats') || '{}');
    let currentChatProfile = null;

    function toggleTheme() {
      document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    function showPage(page) {
      document.getElementById('browseSection').style.display = page === 'browse' ? 'block' : 'none';
      document.getElementById('chatsSection').style.display = page === 'chats' ? 'block' : 'none';
      if(page === 'chats') renderMatches();
    }

    function nextProfile() {
      currentIdx = (currentIdx + 1) % profiles.length;
      const p = profiles[currentIdx];
      document.getElementById('pName').textContent = `${p.name}, ${p.age}`;
      document.getElementById('pBio').textContent = p.bio;
      document.getElementById('mainEmoji').textContent = p.emoji;
    }

    function likeProfile() {
      const p = profiles[currentIdx];
      if (!matches.find(m => m.id === p.id)) {
        matches.push(p);
        localStorage.setItem('my_matches', JSON.stringify(matches));
      }
      showPage('chats');
    }

    function renderMatches() {
      const list = document.getElementById('matchesList');
      list.innerHTML = matches.length ? '' : '<p style="opacity:0.5; text-align:center;">–ü–æ–∫–∞ –ø–∞—Ä –Ω–µ—Ç</p>';
      matches.forEach(m => {
        const div = document.createElement('div');
        div.style = "padding:15px; background:white; margin-bottom:10px; border-radius:18px; cursor:pointer; display:flex; gap:15px; align-items:center; color:#000;";
        div.onclick = () => openChat(m);
        div.innerHTML = `<span style="font-size:30px;">${m.emoji}</span> <b>${m.name}</b>`;
        list.appendChild(div);
      });
    }

    function openChat(profile) {
      currentChatProfile = profile;
      document.getElementById('chatName').textContent = profile.name;
      document.getElementById('chatModal').classList.add('active');
      if (!chatHistory[profile.id]) chatHistory[profile.id] = [];
      renderMessages();
    }

    function closeChat() { document.getElementById('chatModal').classList.remove('active'); }

    function renderMessages() {
      const log = document.getElementById('chatLog');
      log.innerHTML = '';
      (chatHistory[currentChatProfile.id] || []).forEach(m => {
        const d = document.createElement('div');
        d.className = `msg ${m.me ? 'me' : 'other'}`;
        d.textContent = m.text;
        log.appendChild(d);
      });
      log.scrollTop = log.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;

      chatHistory[currentChatProfile.id].push({ me: true, text });
      input.value = '';
      renderMessages();

      document.getElementById('typing').style.display = 'block';
      const reply = await fetchGeminiReply(text, currentChatProfile);
      document.getElementById('typing').style.display = 'none';

      chatHistory[currentChatProfile.id].push({ me: false, text: reply });
      renderMessages();
      localStorage.setItem('my_chats', JSON.stringify(chatHistory));
    }

    async function fetchGeminiReply(userText, profile) {
      // –ò–°–ü–û–õ–¨–ó–£–ï–ú v1 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è) –≤–º–µ—Å—Ç–æ v1beta
      const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: `–¢—ã –¥–µ–≤—É—à–∫–∞ –ø–æ –∏–º–µ–Ω–∏ ${profile.name}. –û—Ç–≤–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ: ${userText}` }] }]
          })
        });

        const data = await response.json();

        if (data.error) {
           console.error("API Error:", data.error);
           return "–ù—É–∂–µ–Ω VPN –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ä–µ–≥–∏–æ–Ω... (–û—à–∏–±–∫–∞ 404/403)";
        }

        return data.candidates[0].content.parts[0].text;
      } catch (e) {
        return "–°–≤—è–∑—å –ø—Ä–æ–ø–∞–ª–∞... –ü–æ–ø—Ä–æ–±—É–π –≤–∫–ª—é—á–∏—Ç—å VPN! ‚ù§Ô∏è";
      }
    }

    document.getElementById('chatInput').onkeydown = (e) => { if(e.key === 'Enter') sendMessage(); };
  </script>
</body>
</html>
