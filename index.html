<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EvilCorp: Dating App (Gemini AI)</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
    :root { --primary: #FF4757; --bg: #f2f4fb; --text: #1f2330; }
    [data-theme="dark"] { --bg: #0f111a; --text: #ffffff; }
    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; }
    .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
    .profile-card { background: #fff; border-radius: 25px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); position: relative; height: 70vh; }
    [data-theme="dark"] .profile-card { background: #1b1f2c; }
    .photo { height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: grid; place-items: center; position: relative; }
    .photo-emoji { font-size: 100px; }
    .info { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: #white; color: #fff; }
    
    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .actions { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
    .btn-act { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; transition: 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    .btn-act:hover { transform: scale(1.1); }
    .btn-like { background: var(--primary); color: #fff; }
    
    /* –ß–∞—Ç */
    .modal { position: fixed; inset: 0; background: var(--bg); display: none; flex-direction: column; z-index: 1000; }
    .modal.active { display: flex; }
    .chat-log { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 80%; padding: 12px; border-radius: 15px; font-size: 14px; }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; }
    .msg.other { align-self: flex-start; background: #ddd; color: #000; }
    .chat-input { padding: 20px; display: flex; gap: 10px; border-top: 1px solid #ccc; }
    .chat-input input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; outline: none; }

    .nav { display: flex; justify-content: space-around; padding: 15px; background: #fff; border-top: 1px solid #eee; position: sticky; bottom: 0; }
    [data-theme="dark"] .nav { background: #1b1f2c; border-top-color: #333; }
  </style>
</head>
<body>

  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin:0;">EvilCorp <span style="color:var(--primary)">AI</span></h2>
      <button onclick="toggleTheme()" style="background:none; border:none; font-size:20px; cursor:pointer;">üåó</button>
    </div>

    <div id="browseSection">
      <div class="profile-card">
        <div class="photo" id="mainPhoto">
          <div class="photo-emoji" id="mainEmoji">ü¶Å</div>
        </div>
        <div class="info">
          <h2 id="pName">–¢—É—Ä–∞—à –ê–ª–∏, 23</h2>
          <p id="pBio">–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö. –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!</p>
        </div>
      </div>

      <div class="actions">
        <button class="btn-act" onclick="nextProfile()">‚úï</button>
        <button class="btn-act btn-like" onclick="likeProfile()">‚ù§Ô∏è</button>
      </div>
    </div>

    <div id="chatsSection" style="display:none;">
      <h3>–í–∞—à–∏ –ø–∞—Ä—ã</h3>
      <div id="matchesList"></div>
    </div>

    <div class="nav">
      <button onclick="showPage('browse')" style="background:none; border:none; font-size:24px; cursor:pointer;">üîç</button>
      <button onclick="showPage('chats')" style="background:none; border:none; font-size:24px; cursor:pointer;">üí¨</button>
    </div>
  </div>

  <div class="modal" id="chatModal">
    <div style="padding: 15px; border-bottom: 1px solid #ccc; display: flex; align-items: center; gap: 10px;">
      <button onclick="closeChat()" style="background:none; border:none; font-size:20px;">‚Üê</button>
      <strong id="chatName">–ß–∞—Ç</strong>
    </div>
    <div class="chat-log" id="chatLog"></div>
    <div id="typing" style="padding: 10px; font-size: 12px; display:none;">–ø–µ—á–∞—Ç–∞–µ—Ç...</div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
      <button onclick="sendMessage()" style="background:var(--primary); color:white; border:none; padding: 10px 20px; border-radius: 20px;">‚û§</button>
    </div>
  </div>

  <script>
    // 1. –¢–í–û–ô –ö–õ–Æ–ß
    const GEMINI_API_KEY = 'AIzaSyBDHtROba4Ruz5EHaVZoA9QJRGaAiKsU4Y';

    const profiles = [
      { id: 1, name: '–¢—É—Ä–∞—à –ê–ª–∏', age: 23, bio: '–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö.', emoji: 'ü¶Å' },
      { id: 2, name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', age: 24, bio: '–õ—é–±–ª—é IT –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã.', emoji: 'üòé' },
      { id: 3, name: '–ê–π–≥–µ—Ä–∏–º', age: 21, bio: '–õ—é–±–ª—é –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚ú®', emoji: 'üå∏' },
      { id: 4, name: '–ñ–∞–Ω–∏—è', age: 20, bio: '–¢–∞–Ω—Ü—ã ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å!‚òÄÔ∏è', emoji: 'üíÉ' }
    ];

    let currentIdx = 0;
    let matches = [];
    let currentChatProfile = null;
    let chatHistory = {};

    function toggleTheme() {
      document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    function showPage(page) {
      document.getElementById('browseSection').style.display = page === 'browse' ? 'block' : 'none';
      document.getElementById('chatsSection').style.display = page === 'chats' ? 'block' : 'none';
    }

    function nextProfile() {
      currentIdx = (currentIdx + 1) % profiles.length;
      const p = profiles[currentIdx];
      document.getElementById('pName').textContent = `${p.name}, ${p.age}`;
      document.getElementById('pBio').textContent = p.bio;
      document.getElementById('mainEmoji').textContent = p.emoji;
    }

    function likeProfile() {
      const p = profiles[currentIdx];
      if (!matches.find(m => m.id === p.id)) {
        matches.push(p);
        renderMatches();
      }
      alert('–≠—Ç–æ –≤–∑–∞–∏–º–Ω–æ! –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —á–∞—Ç—ã.');
      nextProfile();
    }

    function renderMatches() {
      const list = document.getElementById('matchesList');
      list.innerHTML = '';
      matches.forEach(m => {
        const div = document.createElement('div');
        div.style = "padding:15px; background:#fff; margin-bottom:10px; border-radius:15px; cursor:pointer; display:flex; gap:10px; align-items:center; color:#000;";
        div.onclick = () => openChat(m);
        div.innerHTML = `<span style="font-size:24px;">${m.emoji}</span> <b>${m.name}</b>`;
        list.appendChild(div);
      });
    }

    function openChat(profile) {
      currentChatProfile = profile;
      document.getElementById('chatName').textContent = profile.name;
      document.getElementById('chatModal').classList.add('active');
      if (!chatHistory[profile.id]) chatHistory[profile.id] = [];
      renderMessages();
    }

    function closeChat() {
      document.getElementById('chatModal').classList.remove('active');
    }

    function renderMessages() {
      const log = document.getElementById('chatLog');
      log.innerHTML = '';
      const history = chatHistory[currentChatProfile.id] || [];
      history.forEach(m => {
        const d = document.createElement('div');
        d.className = `msg ${m.me ? 'me' : 'other'}`;
        d.textContent = m.text;
        log.appendChild(d);
      });
      log.scrollTop = log.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;

      chatHistory[currentChatProfile.id].push({ me: true, text });
      input.value = '';
      renderMessages();

      document.getElementById('typing').style.display = 'block';

      // –ó–ê–ü–†–û–° –ö GEMINI
      const reply = await fetchGeminiReply(text, currentChatProfile);
      
      document.getElementById('typing').style.display = 'none';
      chatHistory[currentChatProfile.id].push({ me: false, text: reply });
      renderMessages();
    }

    async function fetchGeminiReply(userText, profile) {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `–¢—ã –¥–µ–≤—É—à–∫–∞ –ø–æ –∏–º–µ–Ω–∏ ${profile.name}. –¢–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä: –º–∏–ª–∞—è, –∫–æ–∫–µ—Ç–ª–∏–≤–∞—è. 
                       –û—Ç–≤–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ) –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ: "${userText}".`
              }]
            }]
          })
        });

        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
      } catch (e) {
        console.error(e);
        return "–£ –º–µ–Ω—è –ø—Ä–æ–ø–∞–ª –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –Ω–æ —Ç—ã –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è! üòä";
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
    document.getElementById('chatInput').onkeydown = (e) => { if(e.key === 'Enter') sendMessage(); };
  </script>
</body>
</html>
