<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EvilCorp Dating AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #FF4757;
      --bg: #ffffff;
      --text: #1e272e;
      --gray: #f1f2f6;
      --shadow: 0 10px 30px -10px rgba(0,0,0,0.15);
    }
    [data-theme="dark"] {
      --bg: #1e272e;
      --text: #ffffff;
      --gray: #2f3542;
    }
    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; transition: 0.3s; }
    
    /* NAV */
    .nav { position: fixed; bottom: 0; width: 100%; background: var(--bg); padding: 15px; display: flex; justify-content: space-around; border-top: 1px solid var(--gray); z-index: 100; }
    .nav-btn { background: none; border: none; font-size: 24px; opacity: 0.5; cursor: pointer; position: relative; }
    .nav-btn.active { opacity: 1; transform: scale(1.1); }
    .badge { position: absolute; top: -5px; right: -5px; background: var(--primary); color: #fff; font-size: 10px; padding: 2px 5px; border-radius: 10px; }

    /* SECTIONS */
    .section { display: none; height: 100%; padding: 20px; padding-bottom: 80px; overflow-y: auto; }
    .section.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* CARDS & UI */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .stats-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
    .stat-card { background: var(--gray); padding: 10px 15px; border-radius: 12px; min-width: 80px; text-align: center; }
    .stat-val { font-weight: 800; font-size: 18px; }
    .stat-label { font-size: 11px; opacity: 0.7; }

    /* PROFILE CARD */
    .photo-card { position: relative; width: 100%; height: 60vh; border-radius: 20px; overflow: hidden; background: #eee; box-shadow: var(--shadow); }
    #photo { width: 100%; height: 100%; background-size: cover !important; transition: 0.3s; }
    #photoEmoji { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; }
    .photo-overlay { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: #fff; padding: 20px; }
    .dots { display: flex; gap: 5px; margin-bottom: 10px; }
    .dot { flex: 1; height: 3px; background: rgba(255,255,255,0.5); border-radius: 2px; }
    .dot.active { background: #fff; }
    
    .actions { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
    .act-btn { width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.2s; }
    .act-btn:active { transform: scale(0.9); }
    .btn-x { background: #fff; color: #ff4757; }
    .btn-heart { background: #ff4757; color: #fff; }
    .btn-super { background: #3742fa; color: #fff; }

    /* MATCHES LIST */
    .match { display: flex; align-items: center; padding: 10px; background: var(--gray); margin-bottom: 10px; border-radius: 12px; cursor: pointer; }
    .avatar { width: 50px; height: 50px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 15px; background-size: cover !important; }
    .match-info { flex: 1; }
    .match-name { font-weight: 700; margin: 0; }
    .match-sub { font-size: 12px; opacity: 0.7; }
    .compat { background: #2ed573; color: #fff; padding: 2px 6px; border-radius: 6px; font-size: 10px; font-weight: 700; }

    /* CHAT MODAL */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 200; display: flex; flex-direction: column; transform: translateY(100%); transition: 0.3s; }
    .modal.active { transform: translateY(0); }
    .chat-header { padding: 15px; border-bottom: 1px solid var(--gray); display: flex; align-items: center; gap: 10px; background: var(--bg); }
    .chat-log { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.4; }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
    .msg.other { align-self: flex-start; background: var(--gray); color: var(--text); border-bottom-left-radius: 4px; }
    .chat-input-area { padding: 10px; border-top: 1px solid var(--gray); display: flex; gap: 10px; background: var(--bg); }
    .chat-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid var(--gray); background: var(--gray); color: var(--text); outline: none; }
    
    /* GIFTS & TOAST */
    .gift-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .gift { background: var(--gray); padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; }
    .gift-emoji { font-size: 32px; display: block; margin-bottom: 5px; }
    .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #333; color: #fff; padding: 10px 20px; border-radius: 30px; display: flex; align-items: center; gap: 10px; z-index: 300; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* EXTRAS */
    .online-list { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; }
    .mini { text-align: center; cursor: pointer; min-width: 60px; }
    .online-dot { width: 10px; height: 10px; background: #2ed573; border-radius: 50%; position: absolute; bottom: 0; right: 0; border: 2px solid var(--bg); }
    .typing { font-size: 12px; color: #aaa; margin-left: 15px; margin-bottom: 5px; display: none; }
  </style>
</head>
<body>

  <div id="toast" class="toast">
    <span id="toastIcon" style="font-size: 20px;"></span>
    <span id="toastText" style="font-weight: 600;"></span>
  </div>

  <div class="nav">
    <button class="nav-btn active" data-section="search" onclick="showSection('search')">üî•</button>
    <button class="nav-btn" data-section="matches" onclick="showSection('matches')">
      üí¨ <span id="unreadBadge" class="badge" style="display:none">0</span>
    </button>
    <button class="nav-btn" data-section="gifts" onclick="showSection('gifts')">üéÅ</button>
    <button class="nav-btn" data-section="profile" onclick="showSection('profile')">üë§</button>
  </div>

  <div id="search" class="section active">
    <div class="header">
      <div>
        <h2 style="margin:0;">Discover</h2>
        <small id="cityDisplay" onclick="filterByCity()">All Cities ‚ñæ</small>
        <select id="citySelect" style="display:none;" onchange="filterByCity()">
          <option value="">All</option>
          <option value="–ê–ª–º–∞—Ç—ã">–ê–ª–º–∞—Ç—ã</option>
          <option value="–ê—Å—Ç–∞–Ω–∞">–ê—Å—Ç–∞–Ω–∞</option>
        </select>
      </div>
      <div style="text-align: right;">
        <span id="starBalance" style="font-weight:800; color:#f1c40f;">1000</span> ‚≠ê
        <button onclick="toggleTheme()" style="background:none;border:none;cursor:pointer;">üåó</button>
        <button onclick="toggleLang()" style="background:none;border:none;cursor:pointer;">üåê</button>
      </div>
    </div>

    <div id="onlineList" class="online-list"></div>

    <div class="photo-card" onclick="nextPhoto()">
      <div id="photo"></div>
      <span id="photoEmoji"></span>
      <div class="photo-overlay">
        <div id="photoDots" class="dots"></div>
        <h2 id="pName" style="margin:0;">Name, 20</h2>
        <div id="pMeta" style="margin-bottom:10px; font-size:14px; opacity:0.8;">City</div>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
          <span id="aiScoreSmall" class="compat">98%</span>
          <span id="verifiedBadge" style="display:none">‚úÖ</span>
          <span id="onlineBadge" style="display:none; color:#2ed573; font-size:12px;">‚óè Online</span>
        </div>
        <p id="pBio" style="font-size:14px; opacity:0.9; margin:0;">Bio text...</p>
        <div id="pTags" style="margin-top:10px; display:flex; gap:5px; flex-wrap:wrap;"></div>
      </div>
    </div>

    <div class="actions">
      <button class="act-btn btn-x" onclick="skip()">‚úï</button>
      <button class="act-btn btn-super" onclick="superLike()">‚≠ê</button>
      <button class="act-btn btn-heart" onclick="like()">‚ù§Ô∏è</button>
    </div>
  </div>

  <div id="matches" class="section">
    <h2>Matches</h2>
    <div id="matchesList"></div>
    <div id="rtBell" style="position:fixed; top:20px; right:20px;"></div>
  </div>

  <div id="gifts" class="section">
    <h2>Gift Shop</h2>
    <p style="opacity:0.6; font-size:14px;">Send gifts to increase match chance!</p>
    <div id="giftsGrid" class="gift-grid"></div>
  </div>

  <div id="profile" class="section">
    <h2>My Profile</h2>
    <div style="text-align:center; margin:20px 0;">
      <div id="meAvatar" class="avatar" style="width:100px; height:100px; margin:0 auto; font-size:40px;">üë§</div>
      <div id="photoPreview" style="width:100px;height:100px;border-radius:50%;background-size:cover;display:none;margin:0 auto;"></div>
      <h3 id="meName">User</h3>
      <p id="meCity" style="opacity:0.6;">City</p>
      <span id="verifiedSmall" style="background:var(--primary);color:#fff;padding:2px 6px;border-radius:4px;">‚Äî</span>
    </div>

    <form id="profileForm" style="display:flex; flex-direction:column; gap:10px;">
      <input id="inpName" placeholder="Your Name" class="chat-input" style="background:var(--bg); padding:15px;">
      <input id="inpCity" placeholder="Your City" class="chat-input" style="background:var(--bg); padding:15px;">
      <label class="btn-super" style="text-align:center; padding:10px; border-radius:10px; cursor:pointer;">
        üì∑ Upload Photo
        <input type="file" hidden onchange="handleFileSelect(event)">
      </label>
      
      <div style="margin:20px 0;">
        <h4>Interests</h4>
        <div id="interestContainer" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
      </div>

      <button type="submit" class="act-btn btn-heart" style="width:100%; border-radius:12px; font-size:16px;">Save Profile</button>
    </form>
    
    <div class="stats-row" style="margin-top:30px;">
      <div class="stat-card"><div class="stat-val" id="views">0</div><div class="stat-label">Views</div></div>
      <div class="stat-card"><div class="stat-val" id="likes">0</div><div class="stat-label">Likes</div></div>
      <div class="stat-card"><div class="stat-val" id="matchCount">0</div><div class="stat-label">Matches</div></div>
    </div>
    
    <button onclick="verifyProfile()" style="width:100%; margin-top:20px; padding:15px; background:#2ed573; border:none; color:#fff; border-radius:12px;">Verify Profile ‚úÖ</button>
  </div>

  <div id="chatModal" class="modal">
    <div class="chat-header">
      <button onclick="closeModal('chatModal')" style="background:none;border:none;font-size:20px;">‚úï</button>
      <div>
        <div id="chatTitle" style="font-weight:700;">Name</div>
        <div id="chatSubtitle" style="font-size:12px; opacity:0.6;">Online</div>
      </div>
    </div>
    <div id="chatLog" class="chat-log"></div>
    <div id="typingIndicator" class="typing">typing...</div>
    <div class="chat-input-area">
      <input id="chatInput" type="text" placeholder="Type a message..." class="chat-input">
      <button onclick="sendMessage()" style="background:var(--primary); color:white; border:none; width:40px; height:40px; border-radius:50%;">‚û§</button>
    </div>
  </div>

  <div id="giftModal" class="modal" onclick="modalBackdropClose(event, 'giftModal')">
    <div style="margin-top:auto; background:var(--bg); padding:20px; border-radius:20px 20px 0 0; max-height:60%;">
      <h3>Send a Gift üéÅ</h3>
      <div id="giftModalGrid" class="gift-grid"></div>
      <button onclick="closeModal('giftModal')" style="width:100%; padding:15px; margin-top:20px; background:var(--gray); border:none; border-radius:12px;">Cancel</button>
    </div>
  </div>

  <script>
    // ==========================================================
    // JS LOGIC (–° –ò–ù–¢–ï–ì–†–ê–¶–ò–ï–ô CHATGPT)
    // ==========================================================

    // üî¥ –í–ê–ñ–ù–û: –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –°–í–û–ô –ö–õ–Æ–ß API OPENAI (sk-...)
    const OPENAI_API_KEY = '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'; 

    const i18n = {
      ru: {
        nav_search: '–ü–æ–∏—Å–∫', nav_chats: '–ß–∞—Ç—ã', nav_gifts: '–ü–æ–¥–∞—Ä–∫–∏', nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', views: '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã', likes: '–õ–∞–π–∫–∏', ai: 'AI Score', verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time', simulate: '–°–∏–º—É–ª—è—Ü–∏—è –º–∞—Ç—á–∞', all_cities: '–í—Å–µ –≥–æ—Ä–æ–¥–∞',
        your_matches: '–í–∞—à–∏ –º–∞—Ç—á–∏', gift_shop: '–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤', online: '–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å',
        your_name: '–í–∞—à–µ –∏–º—è', your_city: '–í–∞—à –≥–æ—Ä–æ–¥', choose_city: '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥',
        interests_label: '–ò–Ω—Ç–µ—Ä–µ—Å—ã', upload_photo: '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ', photo_hint: '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞',
        save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', verify: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è', choose_gift: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω', toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω ‚úì',
        toast_like: '–õ–∞–π–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚ù§Ô∏è', toast_skip: '–ü—Ä–æ–ø—É—Å–∫', toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω üéÅ', toast_match: '–ù–æ–≤—ã–π –º–∞—Ç—á! üíò',
        chat_placeholder: '–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶', rt_new_match: '–ù–æ–≤—ã–π –º–∞—Ç—á', rt_open_chat: '–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç', rt_close: '–ó–∞–∫—Ä—ã—Ç—å',
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞', cat_sport: 'üèÄ –°–ø–æ—Ä—Ç', cat_travel: '‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', cat_gaming: 'üéÆ –ì–µ–π–º–∏–Ω–≥',
        cat_art: 'üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ', cat_cooking: 'üç≥ –ì–æ—Ç–æ–≤–∫–∞', cat_movies: 'üé¨ –ö–∏–Ω–æ', cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', cat_nature: 'üçÉ –ü—Ä–∏—Ä–æ–¥–∞'
      },
      kz: {
        nav_search: '–Ü–∑–¥–µ—É', nav_chats: '–ß–∞—Ç—Ç–∞—Ä', nav_gifts: '–°—ã–π–ª—ã“õ—Ç–∞—Ä', nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', views: '–ö”©—Ä—É–ª–µ—Ä', likes: '“∞–Ω–∞—Ç“õ–∞–Ω–¥–∞—Ä', ai: 'AI Score', verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time', simulate: '–ú–∞—Ç—á —Å–∏–º—É–ª—è—Ü–∏—è—Å—ã', all_cities: '–ë–∞—Ä–ª—ã“õ “õ–∞–ª–∞–ª–∞—Ä',
        your_matches: '–°—ñ–∑–¥—ñ“£ –º–∞—Ç—á—Ç–∞—Ä', gift_shop: '–°—ã–π–ª—ã“õ –¥“Ø–∫–µ–Ω—ñ', online: '“ö–∞–∑—ñ—Ä –æ–Ω–ª–∞–π–Ω',
        your_name: '–ê—Ç—ã“£—ã–∑', your_city: '“ö–∞–ª–∞“£—ã–∑', choose_city: '“ö–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑',
        interests_label: '“ö—ã–∑—ã“ì—É—à—ã–ª—ã“õ—Ç–∞—Ä', upload_photo: '–§–æ—Ç–æ –∂“Ø–∫—Ç–µ—É', photo_hint: '–¢–∞“£–¥–∞—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑',
        save: '–°–∞“õ—Ç–∞—É', verify: '–ü—Ä–æ—Ñ–∏–ª—å–¥—ñ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–ª–∞—É', choose_gift: '–°—ã–π–ª—ã“õ —Ç–∞“£–¥–∞“£—ã–∑',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–∞“õ—Ç–∞–ª–¥—ã', toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–¥–∞–Ω ”©—Ç—Ç—ñ ‚úì',
        toast_like: '–õ–∞–π–∫ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ ‚ù§Ô∏è', toast_skip: '”®—Ç–∫—ñ–∑—É', toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–°—ã–π–ª—ã“õ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ üéÅ', toast_match: '–ñ–∞“£–∞ –º–∞—Ç—á! üíò',
        chat_placeholder: '–•–∞–±–∞—Ä–ª–∞–º–∞‚Ä¶', rt_new_match: '–ñ–∞“£–∞ –º–∞—Ç—á', rt_open_chat: '–ß–∞—Ç—Ç—ã –∞—à—É', rt_close: '–ñ–∞–±—É',
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞', cat_sport: 'üèÄ –°–ø–æ—Ä—Ç', cat_travel: '‚úàÔ∏è –°–∞—è—Ö–∞—Ç', cat_gaming: 'üéÆ –û–π—ã–Ω–¥–∞—Ä',
        cat_art: 'üé® ”®–Ω–µ—Ä', cat_cooking: 'üç≥ –ê—Å–ø–∞–∑–¥—ã“õ', cat_movies: 'üé¨ –ö–∏–Ω–æ', cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è', cat_nature: 'üçÉ –¢–∞–±–∏“ì–∞—Ç'
      }
    };

    const photoGradients = [
      'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
      'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
      'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)'
    ];

    const profileDatabase = [
      { 
        id: 101, name: '–¢—É—Ä–∞—à –ê–ª–∏', age: 23, city: '–ê–ª–º–∞—Ç—ã', emoji: 'ü¶Å', 
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/image%20(2).png', 
        bio: 'üí° AI-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –≤–∞—à–∏–º –æ–±—â–∏–º –∏–Ω—Ç–µ—Ä–µ—Å–∞–º! –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ. üòé', 
        interests: ['üèÄ –°–ø–æ—Ä—Ç', '‚úàÔ∏è –°–∞—è—Ö–∞—Ç', 'üíº –ë–∏–∑–Ω–µ—Å'], verified: true, online: true, aiScore: 98, photos: [0] 
      },
      { 
        id: 102, name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', age: 24, city: '–ê—Å—Ç–∞–Ω–∞', emoji: 'üòé',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132795_x.png', 
        bio: '–õ—é–±–ª—é IT, —Å—Ç–∞—Ä—Ç–∞–ø—ã –∏ –≤–∫—É—Å–Ω—ã–π –∫–æ—Ñ–µ. –ò—â—É —Ç—É —Å–∞–º—É—é.', 
        interests: ['üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '‚òï –ö–æ—Ñ–µ', 'üéÆ –ì–µ–π–º–∏–Ω–≥'], verified: true, online: false, aiScore: 95, photos: [1] 
      },
      { 
        id: 103, name: '–û—Ä–∞–∑–±–∞–∫–æ–≤ –¢–µ–º–∏—Ä–ª–∞–Ω', age: 22, city: '–ê–ª–º–∞—Ç—ã', emoji: 'üî•',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5440511241249473687_c.png', 
        bio: '–í—Å–µ–≥–¥–∞ –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–µ. –õ—é–±–ª—é –≥–æ—Ä—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö üèîÔ∏è', 
        interests: ['üèîÔ∏è –ì–æ—Ä—ã', 'üéµ –ú—É–∑—ã–∫–∞', 'üöó –ê–≤—Ç–æ'], verified: true, online: true, aiScore: 92, photos: [2] 
      },
      { 
        id: 104, name: '–ö–∞–∑–±–µ–∫–æ–≤–∞ –ê–π–≥–µ—Ä–∏–º', age: 21, city: '–ê–ª–º–∞—Ç—ã', emoji: 'üå∏',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132809_x.png', 
        bio: '–ù–µ–∂–Ω–∞—è, –Ω–æ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º. –õ—é–±–ª—é –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚ú®', 
        interests: ['üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ', 'üëó –ú–æ–¥–∞', 'üìö –ö–Ω–∏–≥–∏'], verified: true, online: true, aiScore: 99, photos: [3] 
      },
      { 
        id: 105, name: '–ñ–∞–Ω–∏—è', age: 20, city: '–®—ã–º–∫–µ–Ω—Ç', emoji: 'üíÉ',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132803_m.png', 
        bio: '–£–ª—ã–±–∞–π—Å—è, —Ç–µ–±–µ —ç—Ç–æ –∏–¥–µ—Ç! –õ—é–±–ª—é —Ç–∞–Ω—Ü—ã –∏ –ª–µ—Ç–æ ‚òÄÔ∏è', 
        interests: ['üíÉ –¢–∞–Ω—Ü—ã', 'üé¨ –ö–∏–Ω–æ', 'üç≥ –ì–æ—Ç–æ–≤–∫–∞'], verified: false, online: true, aiScore: 89, photos: [4] 
      }
    ];

    const gifts = [
      { nameKz: '–†–∞—É—à–∞–Ω', nameRu: '–†–æ–∑–∞', emoji: 'üåπ', cost: 10 },
      { nameKz: '–®–æ–∫–æ–ª–∞–¥', nameRu: '–®–æ–∫–æ–ª–∞–¥', emoji: 'üç´', cost: 15 },
      { nameKz: '–¢”ô–∂', nameRu: '–ö–æ—Ä–æ–Ω–∞', emoji: 'üëë', cost: 50 },
      { nameKz: '–ì–∞—É“ª–∞—Ä', nameRu: '–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç', emoji: 'üíé', cost: 100 },
      { nameKz: '–ö–æ—Ñ–µ', nameRu: '–ö–æ—Ñ–µ', emoji: '‚òï', cost: 5 },
      { nameKz: '–†–∞–∫–µ—Ç–∞', nameRu: '–†–∞–∫–µ—Ç–∞', emoji: 'üöÄ', cost: 200 }
    ];

    const interestCategories = ['cat_music', 'cat_sport', 'cat_travel', 'cat_gaming', 'cat_art', 'cat_cooking', 'cat_movies', 'cat_tech', 'cat_nature'];

    const chatPatterns = {
      ru: [
        { keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π'], answers: ['–ü—Ä–∏–≤–µ—Ç! üëã', '–°–∞–ª—é—Ç!', '–ö–∞–∫ –¥–µ–ª–∞?'] },
        { keywords: ['–∫–∞–∫ –¥–µ–ª–∞', '–∫–∞–∫ —Ç—ã'], answers: ['–°—É–ø–µ—Ä! –ê —É —Ç–µ–±—è?', '–í—Å–µ –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!'] },
        { keywords: ['—á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è'], answers: ['–°–º–æ—Ç—Ä—é —Å–µ—Ä–∏–∞–ª. –ê —Ç—ã?', '–û—Ç–¥—ã—Ö–∞—é'] },
        { keywords: ['–ø–æ–∫–∞'], answers: ['–î–æ –≤—Å—Ç—Ä–µ—á–∏!', '–ü–æ–∫–∞-–ø–æ–∫–∞!'] }
      ],
      kz: [
        { keywords: ['—Å”ô–ª–µ–º', '—Å–∞–ª–∞–º'], answers: ['–°”ô–ª–µ–º! üëã', '“ö–∞–ª—ã“£ “õ–∞–ª–∞–π?', '–°”ô–ª–µ–º –±–µ—Ä–¥—ñ–∫!'] },
        { keywords: ['“õ–∞–ª–∞–π—Å—ã“£'], answers: ['–ñ–∞“õ—Å—ã! ”®–∑—ñ“£ —à–µ?', '–®“Ø–∫—ñ—Ä, –∂–∞–º–∞–Ω –µ–º–µ—Å'] },
        { keywords: ['–Ω–µ —ñ—Å—Ç–µ–ø'], answers: ['–î–µ–º–∞–ª—ã–ø –æ—Ç—ã—Ä–º—ã–Ω.', '–ú—É–∑—ã–∫–∞ —Ç—ã“£–¥–∞–ø'] },
        { keywords: ['—Å–∞—É –±–æ–ª'], answers: ['–ö”©—Ä—ñ—Å–∫–µ–Ω—à–µ!', '–°–∞—É –±–æ–ª!'] }
      ]
    };

    let allProfiles = [...profileDatabase];
    let filteredProfiles = [...allProfiles];
    let idx = 0;
    let photoIdx = 0;
    let starBalance = 1000;
    let views = 0;
    let likes = 0;
    let matches = [];
    let chats = {}; 
    let isVerified = false;
    let giftTarget = null;
    let currentChatId = null;
    let unreadCount = 0;
    let lang = 'kz';
    let myInterests = [];
    let myPhoto = null;

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function save() {
      localStorage.setItem('dhp_starBalance', String(starBalance));
      localStorage.setItem('dhp_views', String(views));
      localStorage.setItem('dhp_likes', String(likes));
      localStorage.setItem('dhp_matches', JSON.stringify(matches));
      localStorage.setItem('dhp_chats', JSON.stringify(chats));
      localStorage.setItem('dhp_verified', String(isVerified));
      localStorage.setItem('dhp_lang', String(lang));
    }

    function load() {
      starBalance = parseInt(localStorage.getItem('dhp_starBalance') || '100', 10);
      views = parseInt(localStorage.getItem('dhp_views') || '0', 10);
      likes = parseInt(localStorage.getItem('dhp_likes') || '0', 10);
      matches = JSON.parse(localStorage.getItem('dhp_matches') || '[]');
      chats = JSON.parse(localStorage.getItem('dhp_chats') || '{}');
      isVerified = localStorage.getItem('dhp_verified') === 'true';
      lang = localStorage.getItem('dhp_lang') || 'kz';
    }

    function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
    function t(key) { return i18n[lang]?.[key] ?? i18n.ru[key] ?? key; }
    function toast(icon, text, ms = 2200) { $('#toastIcon').textContent = icon; $('#toastText').textContent = text; const el = $('#toast'); el.classList.add('show'); clearTimeout(toast._t); toast._t = setTimeout(() => el.classList.remove('show'), ms); }

    function calculateCompatibility(profile) {
      if (!myInterests || myInterests.length === 0) return profile.aiScore || 75;
      const myInterestLabels = myInterests.map(cat => t(cat));
      let commonInterests = 0;
      profile.interests.forEach(interest => { if (myInterestLabels.includes(interest)) commonInterests++; });
      const maxInterests = Math.max(myInterests.length, profile.interests.length);
      if (maxInterests === 0) return profile.aiScore || 75;
      let compatibilityScore = Math.round((commonInterests / maxInterests) * 100);
      if (commonInterests > 0) compatibilityScore = Math.max(50, compatibilityScore);
      if (profile.verified) compatibilityScore = Math.min(100, compatibilityScore + 5);
      if (profile.online) compatibilityScore = Math.min(100, compatibilityScore + 3);
      return Math.max(30, Math.min(100, compatibilityScore));
    }

    function updateBadges() {
      $('#starBalance').textContent = starBalance; $('#matchCount').textContent = matches.length;
      $('#views').textContent = views; $('#likes').textContent = likes;
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';
      const badge = $('#unreadBadge');
      if (unreadCount > 0) { badge.style.display = ''; badge.textContent = String(unreadCount); } else { badge.style.display = 'none'; }
    }

    function applyI18n() {
      document.documentElement.setAttribute('data-lang', lang);
      $$('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); el.textContent = t(key); });
      $('#chatInput').placeholder = t('chat_placeholder');
      renderInterests();
    }

    function toggleTheme() { const root = document.documentElement; const isDark = root.getAttribute('data-theme') === 'dark'; root.setAttribute('data-theme', isDark ? 'light' : 'dark'); localStorage.setItem('dhp_theme', isDark ? 'light' : 'dark'); }
    function toggleLang() { lang = (lang === 'kz') ? 'ru' : 'kz'; applyI18n(); renderGifts(); renderMatches(); save(); toast('üåê', lang === 'kz' ? '“ö–∞–∑–∞“õ—à–∞' : '–†—É—Å—Å–∫–∏–π'); }

    function showSection(id) { $$('.section').forEach(s => s.classList.remove('active')); $('#' + id).classList.add('active'); $$('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.section === id)); if (id === 'matches') { unreadCount = 0; updateBadges(); } }

    function currentProfile() { return filteredProfiles.length ? filteredProfiles[idx % filteredProfiles.length] : null; }
    function renderDots(count) { const wrap = $('#photoDots'); wrap.innerHTML = ''; for (let i = 0; i < count; i++) { const d = document.createElement('div'); d.className = 'dot' + (i === photoIdx ? ' active' : ''); wrap.appendChild(d); } }
    
    function displayProfile() {
      const p = currentProfile();
      if (!p) return;
      views++;
      const photoEl = $('#photo');
      const emojiEl = $('#photoEmoji');
      if (p.image && p.image.startsWith('http')) {
        const tempImg = new Image();
        tempImg.onload = function() {
          photoEl.style.background = `url("${p.image}") center/cover no-repeat`;
          emojiEl.style.display = 'none';
        };
        tempImg.onerror = function() {
          photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
          emojiEl.style.display = 'block';
          emojiEl.textContent = p.emoji;
        };
        tempImg.src = p.image;
        photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
        emojiEl.style.display = 'block';
        emojiEl.textContent = p.emoji;
      } else {
        photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
        emojiEl.style.display = 'block';
        emojiEl.textContent = p.emoji;
      }
      $('#pName').textContent = `${p.name}, ${p.age}`;
      $('#pMeta').innerHTML = `üìç ${p.city} ‚Ä¢ ${p.distance || 2}–∫–º`;
      $('#pBio').textContent = p.bio;
      const dynamicScore = calculateCompatibility(p);
      $('#aiScoreSmall').textContent = dynamicScore + '%';
      $('#verifiedBadge').style.display = p.verified ? '' : 'none';
      $('#onlineBadge').style.display = p.online ? '' : 'none';
      $('#pTags').innerHTML = '';
      p.interests.forEach(x => { const el = document.createElement('div'); el.className = 'tag'; el.textContent = x; el.style.background='rgba(255,255,255,0.3)'; el.style.padding='2px 8px'; el.style.borderRadius='8px'; el.style.fontSize='12px'; $('#pTags').appendChild(el); });
      renderDots(p.photos.length); updateBadges(); save();
    }

    function nextPhoto() { const p = currentProfile(); if (!p) return; photoIdx = (photoIdx + 1) % p.photos.length; displayProfile(); }
    function prevPhoto() { const p = currentProfile(); if (!p) return; photoIdx = (photoIdx - 1 + p.photos.length) % p.photos.length; displayProfile(); }
    function skip() { toast('üëã', t('toast_skip')); idx++; photoIdx = 0; displayProfile(); }
    
    function superLike() {
      if (starBalance < 5) { toast('‚ö†Ô∏è', 'Not enough ‚≠ê'); return; }
      starBalance -= 5; likes++; toast('‚≠ê', t('toast_super'));
      tryMatch(true); idx++; photoIdx = 0; displayProfile();
    }
    function like() { likes++; toast('‚ù§Ô∏è', t('toast_like')); tryMatch(false); idx++; photoIdx = 0; displayProfile(); }
    function filterByCity() { const city = $('#citySelect').value; filteredProfiles = city ? allProfiles.filter(p => p.city === city) : [...allProfiles]; idx = 0; photoIdx = 0; displayProfile(); toast('üîé', city ? `City: ${city}` : t('all_cities')); }

    function tryMatch(isSuper) {
      const p = currentProfile(); if (!p) return;
      const chance = Math.min(0.92, (isSuper ? 0.72 : 0.38) + (p.aiScore / 250));
      if (Math.random() <= chance) createMatch(p);
    }

    function createMatch(profile) {
      if (matches.some(m => m.id === profile.id)) return;
      const match = { 
        id: profile.id, 
        name: profile.name, 
        emoji: profile.emoji, 
        image: profile.image, 
        city: profile.city, 
        aiScore: calculateCompatibility(profile), 
        ts: Date.now() 
      };
      matches.unshift(match);
      chats[String(match.id)] = chats[String(match.id)] || [{ me: false, text: '–°”ô–ª–µ–º! üëã', ts: Date.now() }];
      unreadCount++; updateBadges(); renderMatches(); save(); toast('üíò', t('toast_match')); pushRealtimeCard(match);
    }

    function pushRealtimeCard(match) {
      const bell = $('#rtBell');
      const card = document.createElement('div'); card.className = 'match'; card.style.background = '#fff'; card.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';
      card.innerHTML = `<div class="avatar" style="background:${photoGradients[0]}">${match.emoji}</div><div class="match-info"><p class="match-name">New Match!</p><div class="match-sub">${match.name}</div></div>`;
      bell.appendChild(card); setTimeout(() => { if (card.isConnected) card.remove(); }, 5000);
    }
    function simulateRealtimeMatch() { const pool = allProfiles.filter(p => !matches.some(m => m.id === p.id)); if (!pool.length) return; createMatch(pool[Math.floor(Math.random() * pool.length)]); }

    function renderMatches() {
      const list = $('#matchesList'); list.innerHTML = '';
      if (!matches.length) { list.innerHTML = '<div style="padding:10px; opacity:0.6">–ù–µ—Ç –º–∞—Ç—á–µ–π</div>'; return; }
      matches.forEach(m => {
        const row = document.createElement('div'); row.className = 'match'; row.onclick = () => openChat(m.id);
        let avatarStyle = `background:${photoGradients[m.id % photoGradients.length]}`;
        let avatarContent = m.emoji;
        if (m.image && m.image.startsWith('http')) {
             avatarStyle = `background:url('${m.image}') center/cover no-repeat`;
             avatarContent = '';
        }
        const profile = allProfiles.find(p => p.id === m.id);
        const displayScore = profile ? calculateCompatibility(profile) : m.aiScore;
        row.innerHTML = `<div class="avatar" style="${avatarStyle}">${avatarContent}</div><div class="match-info"><p class="match-name">${m.name}</p><div class="match-sub">üìç ${m.city}</div></div><div class="compat">${displayScore}%</div>`;
        list.appendChild(row);
      });
    }

    function openChat(matchId) {
      const m = matches.find(x => x.id === matchId); if (!m) return;
      currentChatId = String(matchId);
      const profile = allProfiles.find(p => p.id === m.id);
      const displayScore = profile ? calculateCompatibility(profile) : m.aiScore;
      $('#chatTitle').textContent = `üí¨ ${m.name}`; $('#chatSubtitle').textContent = `${m.emoji} ${m.city} ‚Ä¢ ${displayScore}%`;
      renderChat(); openModal('chatModal'); unreadCount = Math.max(0, unreadCount - 1); updateBadges();
    }

    function renderChat() {
      const log = $('#chatLog'); log.innerHTML = '';
      const msgs = chats[currentChatId] || [];
      msgs.forEach(msg => { const el = document.createElement('div'); el.className = 'msg ' + (msg.me ? 'me' : 'other'); el.textContent = msg.text; log.appendChild(el); });
      log.scrollTop = log.scrollHeight;
    }

    // -------------------------------------------------------------
    // CHATGPT
    // -------------------------------------------------------------
    async function fetchOpenAIResponse(userMessage, matchProfile, chatHistory) {
      if (!OPENAI_API_KEY || OPENAI_API_KEY.includes('sk-proj-xxxxxxxx')) {
        console.warn("API Key –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é fallback.");
        return new Promise(resolve => setTimeout(() => resolve(getFallbackReply(userMessage)), 1000));
      }
      const messages = [
        { 
          role: "system", 
          content: `–¢—ã ‚Äî ${matchProfile.name}, ${matchProfile.age} –ª–µ—Ç. –¢–≤–æ–π –≥–æ—Ä–æ–¥: ${matchProfile.city}. –¢–≤–æ—ë –±–∏–æ: "${matchProfile.bio}". –¢–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã: ${matchProfile.interests.join(', ')}. 
          –¢—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ –¥–µ–π—Ç–∏–Ω–≥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
          –û—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ, –∏–≥—Ä–∏–≤–æ. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏. –Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–∞: ${lang === 'kz' ? '–ö–∞–∑–∞—Ö—Å–∫–∏–π' : '–†—É—Å—Å–∫–∏–π'}.`
        }
      ];
      chatHistory.slice(-6).forEach(msg => {
        messages.push({ role: msg.me ? "user" : "assistant", content: msg.text });
      });
      messages.push({ role: "user", content: userMessage });

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É CORS –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        const apiUrl = 'https://api.openai.com/v1/chat/completions';
        const response = await fetch('https://corsproxy.io/?' + encodeURIComponent(apiUrl), { 
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({ 
            model: "gpt-3.5-turbo", 
            messages: messages, 
            max_tokens: 150, 
            temperature: 0.8 
          }) // <-- –≠–¢–û –ë–´–õ–û –£–¢–ï–†–Ø–ù–û
        });
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.choices[0].message.content;
      } catch (error) {
        return getFallbackReply(userMessage);
      }
    }

    function getFallbackReply(text) {
      const lower = text.toLowerCase();
      const currentLang = lang === 'kz' ? 'kz' : 'ru'; 
      const patterns = chatPatterns[currentLang];
      for (let p of patterns) {
        if (p.keywords.some(k => lower.includes(k))) return p.answers[Math.floor(Math.random() * p.answers.length)];
      }
      return currentLang === 'kz' ? '“ö—ã–∑—ã“õ –µ–∫–µ–Ω... üòÑ' : '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ... —Ä–∞—Å—Å–∫–∞–∂–∏ –µ—â–µ üòÑ';
    }

    async function sendMessage() {
      if (!currentChatId) return;
      const input = $('#chatInput');
      const text = input.value.trim();
      if (!text) return;

      chats[currentChatId] = chats[currentChatId] || [];
      const historyCopy = [...chats[currentChatId]]; 
      chats[currentChatId].push({ me: true, text, ts: Date.now() });
      input.value = '';
      renderChat();
      save();

      const indicator = $('#typingIndicator');
      if (indicator) indicator.style.display = 'block';
      const log = $('#chatLog');
      log.scrollTop = log.scrollHeight;

      const profile = allProfiles.find(p => String(p.id) === currentChatId) || {};
      const aiReply = await fetchOpenAIResponse(text, profile, historyCopy);
      
      if (indicator) indicator.style.display = 'none';

      chats[currentChatId].push({ me: false, text: aiReply, ts: Date.now() });
      renderChat();
      save();
    }
    // -------------------------------------------------------------

    function renderGifts() {
      const grid = $('#giftsGrid'); const modalGrid = $('#giftModalGrid'); grid.innerHTML = ''; modalGrid.innerHTML = '';
      gifts.forEach((g, i) => {
        const name = lang === 'kz' ? g.nameKz : g.nameRu;
        const card = document.createElement('div'); card.className = 'gift';
        card.innerHTML = `<span class="gift-emoji">${g.emoji}</span><p class="gift-name">${name}</p><span class="gift-cost">‚≠ê ${g.cost}</span>`;
        card.onclick = () => { giftTarget = currentProfile(); openGiftModal(); };
        grid.appendChild(card);
        const card2 = card.cloneNode(true); card2.onclick = () => buyGift(i); modalGrid.appendChild(card2);
      });
    }

    function openGiftModal() { giftTarget = giftTarget || currentProfile(); if (!giftTarget) return; openModal('giftModal'); }
    function buyGift(giftIndex) {
      const g = gifts[giftIndex]; if (!giftTarget) return;
      if (starBalance < g.cost) { toast('‚ö†Ô∏è', 'Not enough ‚≠ê'); return; }
      starBalance -= g.cost; updateBadges(); save(); closeModal('giftModal'); toast('üéÅ', t('toast_gift'));
      if (Math.random() < 0.55) createMatch(giftTarget);
    }
    
    function renderInterests() {
      const container = $('#interestContainer'); container.innerHTML = '';
      interestCategories.forEach(key => {
        const label = t(key); const el = document.createElement('div'); el.className = 'interest-tag'; 
        el.style.border = myInterests.includes(key) ? '2px solid var(--primary)' : '1px solid #ccc';
        el.style.padding = '5px 10px'; el.style.borderRadius = '20px'; el.style.cursor = 'pointer';
        el.textContent = label; el.onclick = () => toggleInterest(key); container.appendChild(el);
      });
    }
    function toggleInterest(key) { if (myInterests.includes(key)) myInterests = myInterests.filter(k => k !== key); else myInterests.push(key); renderInterests(); }
    
    function handleFileSelect(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader(); reader.onload = function(evt) { myPhoto = evt.target.result; updatePhotoPreview(myPhoto); toast('üì∑', 'OK'); }; reader.readAsDataURL(file);
    }
    function updatePhotoPreview(src) {
      const preview = $('#photoPreview'); const meAvatar = $('#meAvatar');
      if (src) { preview.style.display = 'block'; preview.style.backgroundImage = `url(${src})`; meAvatar.style.display = 'none'; }
      else { preview.style.display = 'none'; meAvatar.style.display = 'block'; }
    }

    function verifyProfile() { isVerified = true; updateMe(); updateBadges(); save(); toast('üì∏', t('toast_verified')); }
    function updateMe() { const n = $('#inpName').value.trim() || 'User'; const c = $('#inpCity').value || '‚Äî'; $('#meName').textContent = n; $('#meCity').textContent = c; }
    
    function renderOnline() {
      const list = $('#onlineList'); list.innerHTML = '';
      const onlineUsers = allProfiles.filter(p => p.online).slice(0, 6);
      onlineUsers.forEach(p => {
        const el = document.createElement('div'); el.className = 'mini';
        el.onclick = () => {
          const inFiltered = filteredProfiles.findIndex(x => x.id === p.id);
          if (inFiltered >= 0) idx = inFiltered; else { filteredProfiles = [...allProfiles]; idx = allProfiles.findIndex(x => x.id === p.id); $('#citySelect').value = ''; }
          photoIdx = 0; showSection('search'); displayProfile(); toast('üü¢', `${p.name} online`);
        };
        let avatarStyle = ''; let avatarContent = p.emoji;
        if (p.image && p.image.startsWith('http')) { avatarStyle = `background-image: url('${p.image}'); background-size: cover; background-position: center;`; avatarContent = ''; } 
        else { avatarStyle = `background: ${photoGradients[p.id % photoGradients.length]};`; }
        el.innerHTML = `<div class="avatar" style="${avatarStyle}; width:50px; height:50px; margin:0 auto; position:relative;">${avatarContent}<div class="online-dot"></div></div><div style="font-size:12px; margin-top:4px;">${p.name.split(' ')[0]}</div>`;
        list.appendChild(el);
      });
    }

    function openModal(id) { $('#' + id).classList.add('active'); }
    function closeModal(id) { $('#' + id).classList.remove('active'); }
    function modalBackdropClose(e, id) { if (e.target.id === id) closeModal(id); }

    function init() {
      const theme = localStorage.getItem('dhp_theme') || 'light'; document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.setAttribute('data-lang', lang);
      shuffle(allProfiles); filteredProfiles = [...allProfiles];
      renderDots(4); 
      renderOnline();
      renderGifts(); renderMatches(); displayProfile();
      load(); updateMe(); updateBadges(); applyI18n();
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';
      $('#profileForm').addEventListener('submit', (e) => { e.preventDefault(); updateMe(); save(); toast('üíæ', t('toast_saved')); });
      $('#chatInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); sendMessage(); } });
    }

    window.toggleTheme = toggleTheme; window.toggleLang = toggleLang; window.showSection = showSection; window.filterByCity = filterByCity;
    window.nextPhoto = nextPhoto; window.prevPhoto = prevPhoto; window.like = like; window.skip = skip; window.superLike = superLike;
    window.openGiftModal = openGiftModal; window.closeModal = closeModal; window.modalBackdropClose = modalBackdropClose; window.buyGift = buyGift;
    window.openChat = openChat; window.sendMessage = sendMessage; window.verifyProfile = verifyProfile; window.simulateRealtimeMatch = simulateRealtimeMatch;
    window.handleFileSelect = handleFileSelect; window.toggleInterest = toggleInterest;

    init();
  </script>
</body>
</html>

