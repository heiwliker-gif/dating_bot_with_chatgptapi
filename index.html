<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EvilCorp: Dating App (Gemini AI Full)</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #FF4757; --bg: #f2f4fb; --text: #1f2330; }
    [data-theme="dark"] { --bg: #0f111a; --text: #ffffff; }
    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; overflow-x: hidden; }
    .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
    .profile-card { background: #fff; border-radius: 25px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); position: relative; height: 65vh; transition: 0.3s; }
    [data-theme="dark"] .profile-card { background: #1b1f2c; }
    .photo { height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: grid; place-items: center; position: relative; }
    .photo-emoji { font-size: 100px; }
    .info { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: #fff; }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .actions { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
    .btn-act { width: 65px; height: 65px; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; transition: 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); display: grid; place-items: center; }
    .btn-act:hover { transform: scale(1.1); }
    .btn-like { background: var(--primary); color: #fff; }
    .btn-skip { background: #fff; color: #333; }

    /* –ß–∞—Ç –ú–æ–¥–∞–ª–∫–∞ */
    .modal { position: fixed; inset: 0; background: var(--bg); display: none; flex-direction: column; z-index: 1000; }
    .modal.active { display: flex; }
    .chat-log { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.4; }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
    .msg.other { align-self: flex-start; background: #e4e6eb; color: #000; border-bottom-left-radius: 4px; }
    [data-theme="dark"] .msg.other { background: #3a3b3c; color: #fff; }
    
    .chat-input { padding: 15px; display: flex; gap: 10px; border-top: 1px solid rgba(0,0,0,0.1); background: var(--bg); }
    .chat-input input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; outline: none; font-size: 16px; }
    .btn-send { background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; }

    .nav { display: flex; justify-content: space-around; padding: 15px; background: #fff; border-top: 1px solid #eee; position: sticky; bottom: 0; z-index: 10; }
    [data-theme="dark"] .nav { background: #1b1f2c; border-top-color: #333; }
    .nav button { background: none; border: none; font-size: 24px; cursor: pointer; opacity: 0.6; }
    .nav button.active { opacity: 1; transform: scale(1.1); }

    .typing { padding: 5px 20px; font-size: 12px; color: var(--primary); font-style: italic; display: none; }
  </style>
</head>
<body>

  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin:0;">EvilCorp <span style="color:var(--primary)">AI</span></h2>
      <button onclick="toggleTheme()" style="background:none; border:none; font-size:20px; cursor:pointer;">üåó</button>
    </div>

    <div id="browseSection">
      <div class="profile-card">
        <div class="photo" id="mainPhoto">
          <div class="photo-emoji" id="mainEmoji">ü¶Å</div>
        </div>
        <div class="info">
          <h2 id="pName">–¢—É—Ä–∞—à –ê–ª–∏, 23</h2>
          <p id="pBio">–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö. –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn-act btn-skip" onclick="nextProfile()">‚úï</button>
        <button class="btn-act btn-like" onclick="likeProfile()">‚ù§Ô∏è</button>
      </div>
    </div>

    <div id="chatsSection" style="display:none;">
      <h3 style="margin-top:0;">–í–∞—à–∏ —Å–∏–º–ø–∞—Ç–∏–∏</h3>
      <div id="matchesList"></div>
    </div>

    <div class="nav">
      <button id="navBrowse" class="active" onclick="showPage('browse')">üîç</button>
      <button id="navChats" onclick="showPage('chats')">üí¨</button>
    </div>
  </div>

  <div class="modal" id="chatModal">
    <div style="padding: 15px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px;">
      <button onclick="closeChat()" style="background:none; border:none; font-size:24px; cursor:pointer;">‚Üê</button>
      <strong id="chatName" style="font-size:18px;">–ß–∞—Ç</strong>
    </div>
    <div class="chat-log" id="chatLog"></div>
    <div id="typing" class="typing">–ø–µ—á–∞—Ç–∞–µ—Ç...</div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å...">
      <button class="btn-send" onclick="sendMessage()">‚û§</button>
    </div>
  </div>

  <script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const GEMINI_API_KEY = 'AIzaSyBDHtROba4Ruz5EHaVZoA9QJRGaAiKsU4Y';

    const profiles = [
      { id: 101, name: '–¢—É—Ä–∞—à –ê–ª–∏', age: 23, bio: '–õ—é–±–ª—é —Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö. –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!', emoji: 'ü¶Å' },
      { id: 102, name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', age: 24, bio: '–õ—é–±–ª—é IT –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã. –ò—â—É —Ç—É —Å–∞–º—É—é.', emoji: 'üòé' },
      { id: 103, name: '–ê–π–≥–µ—Ä–∏–º', age: 21, bio: '–õ—é–±–ª—é –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚ú®', emoji: 'üå∏' },
      { id: 104, name: '–ñ–∞–Ω–∏—è', age: 20, bio: '–¢–∞–Ω—Ü—ã ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å!‚òÄÔ∏è', emoji: 'üíÉ' },
      { id: 105, name: '–î–∞–Ω–∏—è—Ä', age: 25, bio: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –≥–æ—Ä—ã ‚Äî –º–æ—è —Å—Ç—Ä–∞—Å—Ç—å.', emoji: '‚õ∞Ô∏è' }
    ];

    let currentIdx = 0;
    let matches = JSON.parse(localStorage.getItem('my_matches') || '[]');
    let chatHistory = JSON.parse(localStorage.getItem('my_chats') || '{}');
    let currentChatProfile = null;

    // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
    function toggleTheme() {
      const isDark = document.body.getAttribute('data-theme') === 'dark';
      document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
    }

    function showPage(page) {
      document.getElementById('browseSection').style.display = page === 'browse' ? 'block' : 'none';
      document.getElementById('chatsSection').style.display = page === 'chats' ? 'block' : 'none';
      document.getElementById('navBrowse').classList.toggle('active', page === 'browse');
      document.getElementById('navChats').classList.toggle('active', page === 'chats');
      if(page === 'chats') renderMatches();
    }

    function nextProfile() {
      currentIdx = (currentIdx + 1) % profiles.length;
      const p = profiles[currentIdx];
      document.getElementById('pName').textContent = `${p.name}, ${p.age}`;
      document.getElementById('pBio').textContent = p.bio;
      document.getElementById('mainEmoji').textContent = p.emoji;
    }

    function likeProfile() {
      const p = profiles[currentIdx];
      if (!matches.find(m => m.id === p.id)) {
        matches.push(p);
        localStorage.setItem('my_matches', JSON.stringify(matches));
      }
      alert(`–í—ã –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å ${p.name}!`);
      showPage('chats');
    }

    function renderMatches() {
      const list = document.getElementById('matchesList');
      list.innerHTML = matches.length ? '' : '<p style="text-align:center; opacity:0.5;">–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç...</p>';
      matches.forEach(m => {
        const div = document.createElement('div');
        div.style = "padding:15px; background:var(--bg); border:1px solid rgba(0,0,0,0.1); margin-bottom:10px; border-radius:18px; cursor:pointer; display:flex; gap:15px; align-items:center;";
        div.onclick = () => openChat(m);
        div.innerHTML = `<span style="font-size:30px;">${m.emoji}</span> <div><b>${m.name}</b><br><small style="opacity:0.6;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å</small></div>`;
        list.appendChild(div);
      });
    }

    // --- –õ–û–ì–ò–ö–ê –ß–ê–¢–ê ---
    function openChat(profile) {
      currentChatProfile = profile;
      document.getElementById('chatName').textContent = profile.name;
      document.getElementById('chatModal').classList.add('active');
      if (!chatHistory[profile.id]) chatHistory[profile.id] = [];
      renderMessages();
    }

    function closeChat() {
      document.getElementById('chatModal').classList.remove('active');
    }

    function renderMessages() {
      const log = document.getElementById('chatLog');
      log.innerHTML = '';
      const history = chatHistory[currentChatProfile.id] || [];
      history.forEach(m => {
        const d = document.createElement('div');
        d.className = `msg ${m.me ? 'me' : 'other'}`;
        d.textContent = m.text;
        log.appendChild(d);
      });
      log.scrollTop = log.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text || !currentChatProfile) return;

      // –ú–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ
      chatHistory[currentChatProfile.id].push({ me: true, text });
      input.value = '';
      renderMessages();
      saveData();

      // –û—Ç–≤–µ—Ç AI
      document.getElementById('typing').style.display = 'block';
      const reply = await fetchGeminiReply(text, currentChatProfile);
      document.getElementById('typing').style.display = 'none';

      chatHistory[currentChatProfile.id].push({ me: false, text: reply });
      renderMessages();
      saveData();
    }

    // --- –†–ê–ë–û–¢–ê –° GEMINI API ---
    async function fetchGeminiReply(userText, profile) {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `–¢—ã –¥–µ–≤—É—à–∫–∞ –ø–æ –∏–º–µ–Ω–∏ ${profile.name}. –¢–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä: –∫–æ–∫–µ—Ç–ª–∏–≤–∞—è, –æ–±—â–∏—Ç–µ–ª—å–Ω–∞—è. 
                       –¢–≤–æ–µ –±–∏–æ: ${profile.bio}. –û—Ç–≤–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ –∏ –∂–∏–≤–æ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–∞—Ä–Ω—è: "${userText}"`
              }]
            }],
            safetySettings: [
              { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
              { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
              { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
              { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
            ]
          })
        });

        const data = await response.json();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
          return data.candidates[0].content.parts[0].text;
        } else {
          console.error("–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API:", data);
          return "–Ø –¥–∞–∂–µ –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –Ω–∞ —ç—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å... üòâ";
        }
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", e);
        return "–ß—Ç–æ-—Ç–æ —Å–≤—è–∑—å –±–∞—Ä–∞—Ö–ª–∏—Ç, –Ω–∞–ø–∏—à–∏ –µ—â–µ —Ä–∞–∑? ‚ù§Ô∏è";
      }
    }

    function saveData() {
      localStorage.setItem('my_chats', JSON.stringify(chatHistory));
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à
    document.getElementById('chatInput').onkeydown = (e) => { if(e.key === 'Enter') sendMessage(); };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    renderMatches();
  </script>
</body>
</html>
